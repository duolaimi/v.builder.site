// Generated by CoffeeScript 1.9.2

/**
* @fileOverview 将字体文件复制到debug\dist 目录
* 
* @author pjg <iampjg@gmail.com>
* @link http://pjg.pw
* @version $Id$
 */
var CssCtl, Utils, _, autoprefixer, color, crypto, defFontExt, fs, gutil, path, plumber, vfs;

fs = require('fs');

path = require('path');

_ = require('lodash');

crypto = require('crypto');

vfs = require('vinyl-fs');

gutil = require('gulp-util');

autoprefixer = require('gulp-autoprefixer');

plumber = require('gulp-plumber');

color = gutil.colors;

Utils = require('../utils');

defFontExt = ["eot", "svg", "ttf", "woff"];

CssCtl = (function() {
  function CssCtl(opts) {
    var _this, filePaths;
    this.opts = opts;
    _this = this;
    _this.root = _this.opts.root;
    _this.hashLen = _this.opts.hashLen;
    _this.srcPath = _this.opts.srcPath;
    _this.debugPath = _this.opts.debugPath;
    _this.distPath = _this.opts.distPath;
    _this.fontsPath = _this.srcPath + 'fonts';
    _this.fontsDebugPath = _this.debugPath + 'fonts';
    _this.fontsDistPath = _this.distPath + 'fonts';
    _this.fontExt = _this.opts.fontExt || defFontExt;
    filePaths = [];
    _this.fontExt.forEach(function(value, index) {
      return filePaths.push(path.join(_this.fontsPath, '*.' + value));
    });
    _this.filePaths = filePaths;
    _this.env = _this.opts.env;
    _this.isDebug = _this.opts.isDebug;
  }


  /**
   * 从src复制到debug
   */

  CssCtl.prototype.copyDebug = function(cb, offLog) {
    var _cb, _filePaths, _fontsDebugPath, _offLog, _this;
    _this = this;
    _cb = cb || function() {};
    _filePaths = _this.filePaths;
    _fontsDebugPath = _this.fontsDebugPath;
    _offLog = offLog || true;
    return vfs.src(_filePaths).pipe(plumber({
      errorHandler: Utils.errrHandler
    })).pipe(vfs.dest(_fontsDebugPath)).on('end', function() {
      return _cb();
    });
  };


  /**
   * 从debug复制到dist
   */

  CssCtl.prototype.copyDist = function(cb, offLog) {
    var _cb, _filePaths, _fontsDistPath, _offLog, _this;
    _this = this;
    _cb = cb || function() {};
    _filePaths = _this.filePaths;
    _fontsDistPath = _this.fontsDistPath;
    _offLog = offLog || true;
    return vfs.src(_filePaths).pipe(plumber({
      errorHandler: Utils.errrHandler
    })).pipe(vfs.dest(_fontsDistPath)).on('end', function() {
      return _cb();
    });
  };

  return CssCtl;

})();

module.exports = CssCtl;
